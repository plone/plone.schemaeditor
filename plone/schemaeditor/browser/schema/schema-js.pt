<script type="text/javascript" src="++resource++jquery-ui-sortable.js"></script>
<script type="text/javascript">
// wrap this so it runs after page load
jq(document).ready(function() {
    // show/hide spinner on jquery AJAX events
    jq("#kss-spinner").ajaxStart(function(){
        jq(this).show();
    });
    jq("#kss-spinner").ajaxStop(function(){
        jq(this).hide();
    });

    jq("a.schemaeditor-field-options-link").click(function(){
    	//do ajax magic here
    });

    jq(".schemaeditor-delete-field a").click(function(){
    	//ajax call to delete fields
    	
    	//should we be rendering the page with an absolute url so we don't have to 
    	//assemble this in javascript?
    	jq.get(jq(this).attr('href'), 
        // XXX make this nicer
        // once there is an agreement on a lightbox frame mechanism, we can 
        // deal with it that way
        function (data, textStatus) {
          //
        }
    	);
    	
    	//remove node
    	var field_node = jq(this).parents('li.schemaeditor-field');
    	field_node.remove()
    	
    	return false;
    });

    //this is ridiculously easy!
    jq("#schemaeditor-fields").sortable({
        axis: 'y',
        placeholder: 'schemaeditor-field',
        forcePlaceholderSize: true,
    	  update: function(event, ui){
    		  var field = jq(ui.item).find('input.schemaeditor-field-id').val();
      		var pos = jq('.schemaeditor-field').index(ui.item);
          jq.ajax({
            type: "POST",
            url: location.href + '/' + field + '/@@order',
            data: { 'pos': pos },
            // XXX again, we need to decide on a nice ui error message approach
            error: function (XMLHttpRequest, textStatus, errorThrown) {
              alert( 'Error: ' + textStatus );
            }
          });
    	  }
    });
    jq('.schemaeditor-field').css('cursor', 'move');
});
</script>
